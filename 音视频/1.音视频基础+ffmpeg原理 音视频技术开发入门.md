## 音视频环境基础

### 常用工具

* ffmpeg 用于推流到流媒体服务器

* ffplay  通过rtmp 从流媒体服务器取流并播放

* Vlc 可以从rtmp地址取流并播放，而且还可以进行暂停等ffplay没有的操作



### 问题

`ffmpeg -i ~/Documents/new_killer.mp4 -f flv rtmp://localhost/live/test`

#### **推流失败**

* 报错信息：时长不对，没有正确的文件大小，主要原因是时间戳出了问题
* 原因：默认是以最快的方式进行推流，将音频和视频分开，但这样很安宁进行同步。如放音频的时候方法和视频流的时间戳不匹配，就报错。
* 解决：加上-re 参数：让音视频按照原来的数独进行播放（同步）

#### 清晰度不高

* 原因：参数 -f flv 会讲MP4重新编发，再推流到流媒体服务器，对视频质量有损失；
* 解决：增加参数 -c copy，以原来的编码方式推到流媒体服务器; -c:v copy 只针对视频不重新编码。



## 在不同的系统上编译 ffmpeg

### Mac



#### 1. brew 方式安装

`brew install ffmpeg`



##### 2. 编译安装

* **下载 ffmpeg** https://ffmpeg.org/download.html\

* **编译 ffmpeg**

  ./configure --help 可以查看参数，如./configure --help | grep share 可以查看动态库相关的

  -enable-debug打开debug 级别为3

  --enable-shared --disable-static   开启动态库 关闭静态库

  ```
  ./configure --prefix=/usr/local/ffmpeg --enable-debug=3 --enable-shared --disable-static
  make -j 4  # -j 指定多少个CPU并发进行
  make install
  ```

* **ffmpeg 加入环境变量**，如果没有安装zsh，就将zshrc替换为bash_profile

  ```yml
  vim ~/.zshrc
  # 写入以下配置
  export PATH="/usr/local/ffmpeg/bin:$PATH"
  # 使zsh配置文件生效
  source ~/.zshrc
  ```

  

  

  



#### ffmpeg 目录

##### bin: 命令工具

* ffmpeg命令：推送，音视频处理

* ffplay命令：拉流

* ffprole：侦测多媒体文件，文件信息等

##### include:   ffmpeg 的头文件

* libavcodec：编解码
* libavfilter：滤镜 特效
* libavutil：基本工具
* libswresample：音频重采样
* libavdevice：管理设备
* libavformat：文件格式处理
* libpostproc：
* libswscale：视频的缩放等处理

##### lib: ffmpeg的动态库或者静态库

##### share: 文档相关，以及样例       

